{"version":3,"sources":["Molstar.jsx","MolstarComponent.tsx","index.tsx"],"names":["i","addTrajectory","plugin","params","kind","url","format","isBinary","model","builders","data","rawData","label","modelLabel","download","structure","parseTrajectory","trajectory","createModel","provider","dataFormats","get","parse","coordinates","coordinatesLabel","coords","build","toRoot","apply","TrajectoryFromModelAndCoordinates","modelRef","ref","coordinatesRef","dependsOn","StateTransforms","Model","ModelFromTrajectory","modelIndex","commit","createStructure","representation","applyPreset","Molstar","props","modelFile","trajFile","height","width","showAxes","defaultShowControls","showExpand","showControls","showSettings","showSelectionMode","showAnimation","showTrajectoryControls","parentRef","useRef","useEffect","spec","DefaultPluginUISpec","layout","initial","isExpanded","controlsDisplay","config","PluginConfig","Viewport","ShowExpand","ShowControls","ShowSettings","ShowSelectionMode","ShowAnimation","ShowTrajectoryControls","createPluginAsync","current","canvas3d","setProps","camera","helper","axes","name","loadStructure","ParamDefinition","getDefaultValues","CameraHelperParams","clear","undefined","preset","traj","hierarchy","state","isGhost","extension","replace","style","position","overflow","left","top","right","bottom","MyFullScreen","handler","useFullScreenHandle","className","onClick","enter","handle","children","MolstarComponent","render","args","StreamlitComponentBase","withStreamlitConnection","ReactDOM","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.ab31f491.chunk.js","sourcesContent":["import React, { useEffect, useRef } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { DefaultPluginUISpec } from \"molstar/lib/mol-plugin-ui/spec\";\nimport { createPluginAsync } from \"molstar/lib/mol-plugin-ui/index\";\nimport { TrajectoryFromModelAndCoordinates } from 'molstar/lib/mol-plugin-state/transforms/model';\nimport { StateTransforms } from 'molstar/lib/mol-plugin-state/transforms';\nimport { PluginConfig } from \"molstar/lib/mol-plugin/config\";\nimport \"molstar/build/viewer/molstar.css\";\nimport { ParamDefinition } from \"molstar/lib/mol-util/param-definition\";\nimport { CameraHelperParams } from \"molstar/lib/mol-canvas3d/helper/camera-helper\";\n\n\nexport const addTrajectory = async (plugin, params) => {\n  const {kind, url, format, isBinary} = params;\n  if (!plugin) return;\n  let model;\n  let coords;\n  if (params.model.kind === 'model-data' || params.model.kind === 'model-url') {\n    const data =\n        params.model.kind === 'model-data'\n            ? await plugin.builders.data.rawData({ data: params.model.data, label: params.modelLabel })\n            : await plugin.builders.data.download({\n                  url: params.model.url,\n                  isBinary: params.model.isBinary,\n                  label: params.modelLabel,\n              });\n\n    const trajectory = await plugin.builders.structure.parseTrajectory(data, params.model.format ?? 'mmcif');\n    model = await plugin.builders.structure.createModel(trajectory);\n  } else {\n    const data =\n        params.model.kind === 'topology-data'\n            ? await plugin.builders.data.rawData({ data: params.model.data, label: params.modelLabel })\n            : await plugin.builders.data.download({\n                  url: params.model.url,\n                  isBinary: params.model.isBinary,\n                  label: params.modelLabel,\n              });\n\n    const provider = plugin.dataFormats.get(params.model.format);\n    model = await provider.parse(plugin, data);\n  }\n  {\n    const data =\n        params.coordinates.kind === 'coordinates-data'\n            ? await plugin.builders.data.rawData({\n                  data: params.coordinates.data,\n                  label: params.coordinatesLabel,\n              })\n            : await plugin.builders.data.download({\n                  url: params.coordinates.url,\n                  isBinary: params.coordinates.isBinary,\n                  label: params.coordinatesLabel,\n              });\n\n    const provider = plugin.dataFormats.get(params.coordinates.format);\n    coords = await provider.parse(plugin, data);\n  }\n  const trajectory = await plugin\n    .build()\n    .toRoot()\n    .apply(\n        TrajectoryFromModelAndCoordinates,\n        {\n            modelRef: model.ref,\n            coordinatesRef: coords.ref,\n        },\n        { dependsOn: [model.ref, coords.ref] }\n    )\n    .apply(StateTransforms.Model.ModelFromTrajectory, { modelIndex: 0 })\n    .commit();\n  const structure = await plugin.builders.structure.createStructure(trajectory);\n  await plugin.builders.structure.representation.applyPreset(structure, 'auto');\n};\n\n\nconst Molstar = props => {\n\n  const {\n    modelFile, trajFile,\n    height='100%', width='100%',\n    showAxes=true,\n    defaultShowControls=false,\n    showExpand=true, showControls=true, showSettings=true, showSelectionMode=true, showAnimation=false, showTrajectoryControls=true\n  } = props;\n  const parentRef = useRef(null);\n  const canvasRef = useRef(null);\n  const plugin = useRef(null);\n  \n  useEffect(() => {\n    (async () => {\n      const spec = DefaultPluginUISpec();\n      spec.layout = {\n        initial: {\n          isExpanded: false,\n          controlsDisplay: \"reactive\",\n          showControls: defaultShowControls,\n        },\n      };\n      spec.config = [\n        [PluginConfig.Viewport.ShowExpand, showExpand],\n        [PluginConfig.Viewport.ShowControls, showControls],\n        [PluginConfig.Viewport.ShowSettings, showSettings],\n        [PluginConfig.Viewport.ShowSelectionMode, showSelectionMode],\n        [PluginConfig.Viewport.ShowAnimation, showAnimation],\n        [PluginConfig.Viewport.ShowTrajectoryControls, showTrajectoryControls],\n      ];\n      plugin.current = await createPluginAsync(parentRef.current, spec);\n    \n      if (!showAxes) {\n        // eslint-disable-next-line\n        plugin.current.canvas3d?.setProps({ camera: { helper: { axes: {\n          name: \"off\", params: {}\n        } } } });\n      }\n      await loadStructure(modelFile, trajFile, plugin.current);\n    })();\n    return () => plugin.current = null;\n  }, [])\n\n\n  useEffect(() => {\n    loadStructure(modelFile, trajFile, plugin.current);\n  }, [modelFile, trajFile])\n\n\n  useEffect(() => {\n    if (plugin.current) {\n      if (!showAxes) {\n        // eslint-disable-next-line\n        plugin.current.canvas3d?.setProps({ camera: { helper: { axes: {\n          name: \"off\", params: {}\n        } } } })\n      } else {\n        // eslint-disable-next-line\n        plugin.current.canvas3d?.setProps({ camera: { helper: {\n          axes: ParamDefinition.getDefaultValues(CameraHelperParams).axes\n        } } })\n      }\n    }\n  }, [showAxes]) \n\n\n  const loadStructure = async (modelFile, trajFile, plugin) => {\n    if (plugin) {\n      plugin.clear();\n      if (trajFile) {\n        await addTrajectory(plugin, {\n          model: {\n              kind: (modelFile.url?'model-url': 'model-data'),\n              url: (modelFile.url?modelFile.url:undefined),\n              data: (modelFile.data?modelFile.data:undefined),\n              format: modelFile.format,\n          },\n          coordinates: {\n              kind: (trajFile.url?'coordinates-url': 'coordinates-data'),\n              url: (trajFile.url?trajFile.url:undefined),\n              data: (trajFile.data?trajFile.data:undefined),\n              format: trajFile.format,\n              isBinary: true,\n          },\n          preset: 'all-models',\n        });\n      } else if (modelFile.data) {\n          const data = await plugin.builders.data.rawData({\n            data: modelFile.data\n          });\n          const traj = await plugin.builders.structure.parseTrajectory(data, modelFile.format);\n          await plugin.builders.structure.hierarchy.applyPreset(traj, \"default\");\n      } else {\n        const data = await plugin.builders.data.download(\n          { url: modelFile.url }, {state: {isGhost: true}}\n        );\n        let extension = modelFile.format.replace(\"cif\", \"mmcif\");\n        const traj = await plugin.builders.structure.parseTrajectory(data, extension);\n        await plugin.builders.structure.hierarchy.applyPreset(traj, \"default\");\n      }\n    }\n  }\n  return (\n    <div style={{position: \"absolute\", width, height, overflow: \"hidden\"}}>\n      <div ref={parentRef} style={{position: \"absolute\", left: 0, top: 0, right: 0, bottom: 0}} />\n    </div>\n  )\n};\n\nMolstar.propTypes = {\n  modelFile: PropTypes.object,\n  trajFile:  PropTypes.object,\n\n  // Viz Control\n  showAxes: PropTypes.bool,\n  showControls: PropTypes.bool,\n  showExpand: PropTypes.bool,\n  showAnimation: PropTypes.bool,\n  showSettings: PropTypes.bool,\n  showSelectionMode: PropTypes.bool,\n  showTrajectoryControls: PropTypes.bool,\n  defaultShowControls:  PropTypes.bool,\n\n  // More\n  width: PropTypes.string,\n  height: PropTypes.string,\n};\n\nexport default Molstar;","import {\n  Streamlit,\n  StreamlitComponentBase,\n  withStreamlitConnection,\n} from \"streamlit-component-lib\";\nimport React, { ReactNode } from \"react\";\nimport { FullScreen, useFullScreenHandle } from 'react-full-screen';\n// @ts-ignore\n//import Molstar from \"molstar-react\";\nimport Molstar from \"./Molstar.jsx\";\nimport './MolstarComponent.css';\n\ninterface State {}\n\nconst MyFullScreen = (props: any) => {\n  const handler = useFullScreenHandle();\n  return (\n    <>\n      <button className='fullscreen-button' onClick={handler.enter}>\n        <span></span>\n        <span></span>\n        <span></span>\n        <span></span>\n      </button>\n      <FullScreen className='myfullscreen' handle={handler}>\n        {props.children}\n      </FullScreen>\n    </>\n  );\n};\n\n\nclass MolstarComponent extends StreamlitComponentBase<State> {\n\n  public render = (): ReactNode => {\n    const height = this.props.args[\"height\"]\n    const modelFile = this.props.args[\"modelFile\"]\n    const trajFile = this.props.args[\"trajFile\"]\n    if (modelFile.data) {\n      modelFile.data = this.props.args[\"modelFile_data\"];\n    }\n    if (trajFile && trajFile.data) {\n      trajFile.data =  this.props.args[\"trajFile_data\"];\n    }\n    return (\n      <div style={{ height: height }}>\n        <MyFullScreen>\n          <Molstar\n            modelFile={ modelFile }\n            trajFile={ trajFile }\n            showExpand={false}\n          />\n        </MyFullScreen>\n      </div>\n    )\n  }\n}\n\n// \"withStreamlitConnection\" is a wrapper function. It bootstraps the\n// connection between your component and the Streamlit app, and handles\n// passing arguments from Python -> Component.\n//\n// You don't need to edit withStreamlitConnection (but you're welcome to!).\nexport default withStreamlitConnection(MolstarComponent)\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport MolstarComponent from \"./MolstarComponent\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <MolstarComponent />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)"],"sourceRoot":""}