"use strict";(self.webpackChunkjupyterlab_bpmn=self.webpackChunkjupyterlab_bpmn||[]).push([[643],{5494:(t,e,i)=>{i.r(e),i.d(e,{OutputWidget:()=>b,default:()=>D,rendererFactory:()=>h});var n=i(3706),s=i(2573),o=i(117),a=i(1842),g=i(4252),c=i(6858),I=i(5717),r=i.n(I),d=i(7487);let M=null;function l(t,e){c.Z.call(M,t,1500),M.canRender=function(t){return(0,g.is)(t,"bpmn:ServiceTask")&&t.id.match(/robot/i)},M.drawShape=function(t,i){e.handlers["bpmn:Task"](t,i);const n=(0,d.Ue)("image",{x:-1,y:-1,width:32,height:32,href:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgdmlld0JveD0iMCAwIDIwMi40MzI1IDIwMi4zNDEyNSIKICAgaGVpZ2h0PSIyMDIuMzQxMjUiCiAgIHdpZHRoPSIyMDIuNDMyNSIKICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnMiI+PG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhOCI+PHJkZjpSREY+PGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPjxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PjxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGRlZnMKICAgICBpZD0iZGVmczYiPjxjbGlwUGF0aAogICAgICAgaWQ9ImNsaXBQYXRoMTYiCiAgICAgICBjbGlwUGF0aFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGgKICAgICAgICAgaWQ9InBhdGgxOCIKICAgICAgICAgZD0ibSAwLDE2MS44NzMgMTYxLjk0NiwwIEwgMTYxLjk0NiwwIDAsMCAwLDE2MS44NzMgWiIgLz48L2NsaXBQYXRoPjwvZGVmcz48ZwogICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMjUsMCwwLC0xLjI1LDAsMjAyLjM0MTI1KSIKICAgICBpZD0iZzEwIj48ZwogICAgICAgaWQ9ImcxMiI+PGcKICAgICAgICAgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMTYpIgogICAgICAgICBpZD0iZzE0Ij48ZwogICAgICAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUyLjQ0NzcsODguMTI2OCkiCiAgICAgICAgICAgaWQ9ImcyMCI+PHBhdGgKICAgICAgICAgICAgIGlkPSJwYXRoMjIiCiAgICAgICAgICAgICBzdHlsZT0iZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lIgogICAgICAgICAgICAgZD0ibSAwLDAgYyAwLDcuNiA2LjE3OSwxMy43NzkgMTMuNzcsMTMuNzc5IDcuNiwwIDEzLjc3OSwtNi4xNzkgMTMuNzc5LC0xMy43NzkgMCwtMi43NjkgLTIuMjM4LC01LjAwNyAtNC45OTgsLTUuMDA3IC0yLjc2MSwwIC00Ljk5OSwyLjIzOCAtNC45OTksNS4wMDcgMCwyLjA3OCAtMS42OTUsMy43NjUgLTMuNzgyLDMuNzY1IEMgMTEuNjkzLDMuNzY1IDkuOTk3LDIuMDc4IDkuOTk3LDAgOS45OTcsLTIuNzY5IDcuNzYsLTUuMDA3IDQuOTk5LC01LjAwNyAyLjIzOCwtNS4wMDcgMCwtMi43NjkgMCwwIG0gNTcuMDUsLTIzLjE1MyBjIDAsLTIuNzcxIC0yLjIzNywtNS4wMDcgLTQuOTk4LC01LjAwNyBsIC00Ni4zNzgsMCBjIC0yLjc2MSwwIC00Ljk5OSwyLjIzNiAtNC45OTksNS4wMDcgMCwyLjc2OSAyLjIzOCw1LjAwNyA0Ljk5OSw1LjAwNyBsIDQ2LjM3OCwwIGMgMi43NjEsMCA0Ljk5OCwtMi4yMzggNC45OTgsLTUuMDA3IE0gMzUuMzc5LC0yLjgwNSBjIC0xLjU0NSwyLjI5MSAtMC45NDEsNS4zOTggMS4zNSw2Ljk0MyBsIDExLjU5NCw3LjgzIGMgMi4yNzMsMS41OCA1LjM5OCwwLjk0MSA2Ljk0MywtMS4zMzIgMS41NDUsLTIuMjkgMC45NDEsLTUuMzk4IC0xLjM1LC02Ljk0MyBsIC0xMS41OTQsLTcuODMgYyAtMC44NTIsLTAuNTg2IC0xLjgyOSwtMC44NyAtMi43ODgsLTAuODcgLTEuNjA3LDAgLTMuMTg3LDAuNzgxIC00LjE1NSwyLjIwMiBtIDMxLjc0OCwtMzAuNzg2IGMgMCwtMC45NDUgLTAuMzc2LC0xLjg1MiAtMS4wNDUsLTIuNTIyIGwgLTguNjE3LC04LjYxNyBjIC0wLjY2OSwtMC42NjggLTEuNTc2LC0xLjA0NSAtMi41MjMsLTEuMDQ1IGwgLTUyLjgzMywwIGMgLTAuOTQ3LDAgLTEuODU0LDAuMzc3IC0yLjUyMywxLjA0NSBsIC04LjYxNyw4LjYxNyBjIC0wLjY2OSwwLjY3IC0xLjA0NSwxLjU3NyAtMS4wNDUsMi41MjIgbCAwLDUyLjc5OSBjIDAsMC45NDcgMC4zNzYsMS44NTQgMS4wNDUsMi41MjIgbCA4LjYxNyw4LjYxOSBjIDAuNjY5LDAuNjY4IDEuNTc2LDEuMDQ0IDIuNTIzLDEuMDQ0IGwgNTIuODMzLDAgYyAwLjk0NywwIDEuODU0LC0wLjM3NiAyLjUyMywtMS4wNDQgbCA4LjYxNywtOC42MTkgYyAwLjY2OSwtMC42NjggMS4wNDUsLTEuNTc1IDEuMDQ1LC0yLjUyMiBsIDAsLTUyLjc5OSB6IG0gNy4zMzQsNjEuMDg2IC0xMS4yNSwxMS4yNSBjIC0xLjcwNSwxLjcwNSAtNC4wMTgsMi42NjMgLTYuNDI4LDIuNjYzIGwgLTU2LjUyMywwIGMgLTIuNDEyLDAgLTQuNzI1LC0wLjk1OSAtNi40MywtMi42NjUgTCAtMTcuNDEyLDI3LjQ5NCBjIC0xLjcwNCwtMS43MDUgLTIuNjYxLC00LjAxNiAtMi42NjEsLTYuNDI3IGwgMCwtNTYuNTE1IGMgMCwtMi40MTEgMC45NTgsLTQuNzI1IDIuNjYzLC02LjQyOCBsIDExLjI1LC0xMS4yNSBjIDEuNzA1LC0xLjcwNSA0LjAxNywtMi42NjIgNi40MjgsLTIuNjYyIGwgNTYuNTE1LDAgYyAyLjQxLDAgNC43MjMsMC45NTcgNi40MjgsMi42NjIgbCAxMS4yNSwxMS4yNSBjIDEuNzA1LDEuNzAzIDIuNjYzLDQuMDE3IDIuNjYzLDYuNDI4IGwgMCw1Ni41MTQgYyAwLDIuNDEyIC0wLjk1OCw0LjcyNCAtMi42NjMsNi40MjkiIC8+PC9nPjwvZz48L2c+PC9nPjwvc3ZnPg=="});return(0,d.R3)(t,n),n}}M=l,r()(l,c.Z),l.$inject=["eventBus","bpmnRenderer"];const w={__init__:["RobotFrameworkTask"],RobotFrameworkTask:["type",l]};var y=i(8670),L=i(9674),u=i(8221);const m="#52B415",C=["bpmn:SubProcess"];var j=i(3601),N=i.n(j),p=i(3593);const A="application/bpmn+xml";class b extends n.Widget{constructor(t){super(),this._mimeType=t.mimeType,this.addClass("mimerenderer-bpmn")}async renderModel(t){try{let e=!1,i=!1;if(this._bpmn||(this._bpmn=new s.Z({additionalModules:[w,o.Z,a.Z],moddleExtensions:{camunda:p}}),e=!0),t.data[this._mimeType]&&t.data[this._mimeType]!==this._xml&&(this._xml=t.data[this._mimeType],await this._bpmn.importXML(this._xml),e=!0),t.data["application/bpmn+json"]&&t.data["application/bpmn+json"]!==this._json&&(this._json=t.data["application/bpmn+json"],e=!0),this._bpmn&&this._bpmn.attachTo(this.node),this._bpmn&&e){const e=JSON.parse(t.data["application/bpmn+json"]||"{}");if((e.activities||e.incidents)&&((t,e,i)=>{const n={},s={},o={},a={};for(const t of e){const e=t.activityId;n[e]=n[e]?n[e]+1:1,t.endTime||(s[e]=s[e]?s[e]+1:1)}for(const t of i){const e=t.activityId;s[e]=s[e]?s[e]+1:1,o[e]=o[e]?o[e]+1:1,a[e]=a[e]?`${a[e]}\n${t.incidentMessage||""}`.replace(/\s+$/g,""):`${t.incidentMessage||""}`.replace(/\s+$/g,"")}const g=t.get("overlays"),c=g.get({type:"badge"});for(const t of Object.keys(n)){const e=document.createElement("span");e.innerText=`${n[t]}`,e.className="badge",e.style.cssText="\nbackground: lightgray;\nborder: 1px solid #143d52;\ncolor: #143d52;\n\ndisplay: inline-block;\nmin-width: 10px;\npadding: 3px 7px;\nfont-size: 12px;\nfont-weight: bold;\nline-height: 1;\ntext-align: center;\nwhite-space: nowrap;\nvertical-align: middle;\nborder-radius: 10px;\n ",g.add(t.split("#")[0],"badge",{position:{bottom:17,right:10},html:e})}for(const t of Object.keys(s)){const e=document.createElement("span");e.innerText=`${s[t]}`,e.className="badge",e.style.cssText="\nbackground: #70b8db;\nborder: 1px solid #143d52;\ncolor: #143d52;\n\ndisplay: inline-block;\nmin-width: 10px;\npadding: 3px 7px;\nfont-size: 12px;\nfont-weight: bold;\nline-height: 1;\ntext-align: center;\nwhite-space: nowrap;\nvertical-align: middle;\nborder-radius: 10px;\n ",g.add(t.split("#")[0],"badge",{position:{bottom:17,left:-10},html:e})}for(const t of Object.keys(o))if(o[t]){const e=document.createElement("span");e.innerText=`${o[t]}`,e.title=`${a[t]}`,e.className="badge",e.style.cssText="\nbackground: #b94a48;\nborder: 1px solid #140808;\ncolor: #ffffff;\n\ndisplay: inline-block;\nmin-width: 10px;\npadding: 3px 7px;\nfont-size: 12px;\nfont-weight: bold;\nline-height: 1;\ntext-align: center;\nwhite-space: nowrap;\nvertical-align: middle;\nborder-radius: 10px;\n ",g.add(t.split("#")[0],"badge",{position:{bottom:17,right:10},html:e})}for(const t of c)g.remove(t.id)})(this._bpmn,(null==e?void 0:e.activities)||[],(null==e?void 0:e.incidents)||[]),e.activities&&!1!==e.path){const t=this._flow||[];this._flow=((t,e)=>{const i=t.get("elementRegistry"),n=t.get("canvas"),s=n.getLayer("processInstance",1),o=((t,e)=>{var i,n;const s=new Map,o=new Map,a=new Map,g=new Set;for(const e of t)e.endTime&&!e.canceled&&s.set(e.activityId,!0),a.has(e.activityId)?(null!==(i=a.get(e.activityId))&&void 0!==i?i:[]).push(e.endTime||"Z"):a.set(e.activityId,[e.endTime||"Z"]),o.has(e.activityId)?(null!==(n=o.get(e.activityId))&&void 0!==n?n:[]).push(e.startTime||"Z"):o.set(e.activityId,[e.startTime||"Z"]);const c=new Map((0,y.UI)(t,(t=>{var i,n;const s=e.get(t.activityId);if("exclusiveGateway"===t.activityType&&s.outgoing.length){const e=[],c=a.get(t.activityId)||[];for(let t=0;t<c.length;t++){const i=c[t];s.outgoing.sort(((e,n)=>{var s,a;const g=o.get(e.target.id)||[],c=o.get(n.target.id)||[],I=null!==(s=null==g?void 0:g[t])&&void 0!==s?s:"Z",r=null!==(a=null==c?void 0:c[t])&&void 0!==a?a:"Z";return g.length<=t?1:c.length<=t?-1:I<i?1:r<i?-1:I>r?1:I<r?-1:0})),e.push(s.outgoing[0].id)}for(const t of s.outgoing)e.includes(t.id)||"bpmn:ParallelGateway"===(null===(n=null===(i=t)||void 0===i?void 0:i.target)||void 0===n?void 0:n.type)||g.add(t.id)}return[t.activityId,s]}))),I=t=>{var e;const i=c.get(t),n=null!==(e=a.get(t))&&void 0!==e?e:[];return i&&s.get(t)?[...(0,y.hX)(i.incoming,(t=>{var e;return!g.has(t.id)&&(s.get(t.source.id)&&null!==(e=a.get(t.source.id))&&void 0!==e?e:[]).reduce(((t,e)=>t||n.reduce(((t,i)=>t||e<=i),!1)),!1)})),...(0,y.hX)(i.outgoing,(t=>{var e;return!g.has(t.id)&&(null!==(e=a.get(t.target.id))&&void 0!==e?e:[]).reduce(((t,e)=>t||n.reduce(((t,i)=>t||e>=i),!1)),!1)}))]:[]};let r=[];return(0,y.Ed)(Array.from(c.keys()),(t=>{r=(0,y.uw)("id",[...r,...I(t)])})),r})(null!=e?e:[],i),a=[];let g=(0,L.IO)("defs",n._svg);g||(g=(0,d.Ue)("defs"),(0,d.R3)(n._svg,g));const c=(0,d.Ue)("marker"),I=(0,d.Ue)("path");(0,d.Lj)(c,{id:"arrow",viewBox:"0 0 10 10",refX:7,refY:5,markerWidth:4,markerHeight:4,orient:"auto-start-reverse"}),(0,d.Lj)(I,{d:"M 0 0 L 10 5 L 0 10 z",fill:m,stroke:"blue",strokeWidth:0}),(0,d.R3)(c,I),(0,d.R3)(g,c),a.push(c);for(const t of o){const e=(0,u.createCurve)(t.waypoints,{markerEnd:"url(#arrow)",stroke:m,strokeWidth:4});(0,d.R3)(s,e),a.push(e)}const r=(t=>{const e=[];return t.forEach((i=>{const{target:n}=i;t.forEach((t=>{const{source:s}=t;var o;s!==n||C.includes(s.type)||e.push({waypoints:[i.waypoints[i.waypoints.length-1],(o=n,{x:o.x+o.width/2,y:o.y+o.height/2}),t.waypoints[0]]})}))})),e})(o);for(const t of r){const e=(0,u.createCurve)(t.waypoints,{strokeDasharray:"1 8",strokeLinecap:"round",stroke:m,strokeWidth:4});(0,d.R3)(s,e),a.push(e)}return a})(this._bpmn,e.activities),(t=>{for(const e of t)(0,d.Od)(e)})(t)}if(e.style)for(const t of Object.keys(e.style))this.node.style.setProperty(t,e.style[t]),"height"===t&&e.style[t]!==this._height&&(this._height=e.style[t],i=!0);if(this._bpmn&&e.zoom){if(e.zoom!==this._zoom){const t=this._bpmn.get("elementRegistry");t.get(e.zoom)?this._bpmn.get("canvas").zoom(1,t.get(e.zoom)):(this._bpmn.get("canvas").zoom("fit-viewport","auto"),"fit-viewport"!==e.zoom&&this._bpmn.get("canvas").zoom(e.zoom,"auto")),this._zoom=e.zoom}}else this._bpmn&&i&&this._bpmn.get("canvas").zoom("fit-viewport","auto");if(e.colors){const t=this._bpmn.get("modeling"),i=this._bpmn.get("elementRegistry");for(const n of Object.keys(e.colors)){const s=e.colors[n],o=i.get(n);o&&t.setColor(o,s)}}const n=(await this._bpmn.saveSVG()).svg;t.setData({data:Object.assign(Object.assign({},t.data),{"image/svg+xml":n}),metadata:t.metadata}),e.activities&&setTimeout((async()=>{t.setData({data:Object.assign(Object.assign({},t.data),{"image/svg+xml":n,"image/png":(await N()(this.node,{backgroundColor:null,ignoreElements:function(t){return"SVG"===t.tagName}})).toDataURL().split(";base64,")[1]}),metadata:t.metadata})}),1e3)}}catch(t){console.warn(t)}return Promise.resolve()}}const h={safe:!0,mimeTypes:[A],createRenderer:t=>new b(t)},D={id:"jupyterlab-bpmn:plugin",rendererFactory:h,rank:70,dataType:"string",fileTypes:[{name:"bpmn",mimeTypes:[A],extensions:[".bpmn"]}],documentWidgetFactoryOptions:{name:"JupyterLab BPMN viewer",primaryFileType:"bpmn",fileTypes:["bpmn"],defaultFor:["bpmn"]}}}}]);